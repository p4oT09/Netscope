#!/bin/bash
# NetScope — Advanced ASN/IP Lookup Tool
# Founder: p4oT09

VERSION="1.1"
FOUNDER="p4oT09"
TOOLNAME="NetScope"
TG_CHANNEL="https://t.me/SecretSubjectChannel"
TG_GROUP="https://t.me/SecretSubjectBD"
TG_ID="https://t.me/p4oT09"

# ANSI Colors
RED='\033[1;31m'; GREEN='\033[1;32m'; BLUE='\033[1;34m'
CYAN='\033[1;36m'; YELLOW='\033[1;33m'; MAGENTA='\033[1;35m'; RESET='\033[0m'

usage() {
  echo -e "${CYAN}$TOOLNAME v$VERSION${RESET} — ${GREEN}Founder: $FOUNDER${RESET}"
  echo -e "${YELLOW}ব্যবহার:${RESET} netscope <ASN> [--ipv6|--both|-o dir]"
  echo -e "  --ipv6     শুধু IPv6"
  echo -e "  --both     IPv4 + IPv6"
  echo -e "  -o <dir>   আউটপুট ডিরেক্টরি (ডিফল্ট: current)"
  echo -e "  -h         হেল্প"
}

ASN=""; MODE="ipv4"; OUTDIR="."
while [ $# -gt 0 ]; do
  case "$1" in
    -h|--help) usage; exit 0;;
    --ipv6) MODE="ipv6"; shift;;
    --both) MODE="both"; shift;;
    -o) OUTDIR="$2"; shift 2;;
    AS*|as*) ASN="$(echo "$1" | tr '[:lower:]' '[:upper:]')"; shift;;
    *) echo "❌ Unknown arg: $1"; usage; exit 1;;
  esac
done
if [ -z "$ASN" ]; then usage; exit 1; fi
mkdir -p "$OUTDIR"

# ---------- ISP Full Name ----------
AUTNUM="$(whois -h whois.apnic.net -r -B "$ASN" 2>/dev/null || true)"
ORG_HANDLE="$(printf '%s\n' "$AUTNUM" | awk -F': *' '/^org:/{print $2; exit}')"
ISP_NAME=""
if [ -n "$ORG_HANDLE" ]; then
  ISP_NAME="$(whois -h whois.apnic.net -r -B "$ORG_HANDLE" 2>/dev/null | awk -F': *' '/^org-name:/{print $2; exit}')"
fi
[ -z "$ISP_NAME" ] && ISP_NAME="$(printf '%s\n' "$AUTNUM" | awk -F': *' '/^descr:/{print $2; exit}')"
[ -z "$ISP_NAME" ] && ISP_NAME="$(printf '%s\n' "$AUTNUM" | awk -F': *' '/^as-name:/{print $2; exit}')"
[ -z "$ISP_NAME" ] && ISP_NAME="$ASN"
SAFE_NAME="$(echo "$ISP_NAME" | sed 's/[[:space:]]\+/_/g' | tr -cd '[:alnum:]_.-')"
[ -z "$SAFE_NAME" ] && SAFE_NAME="$ASN"

# ---------- Banner ----------
clear
echo -e "${MAGENTA}====================================================${RESET}"
echo -e "${CYAN}                $TOOLNAME v$VERSION${RESET}"
echo -e "${GREEN}                Founder: $FOUNDER${RESET}"
echo -e "${MAGENTA}====================================================${RESET}"
echo -e "${YELLOW}ASN:${RESET} $ASN"
echo -e "${YELLOW}ISP:${RESET} $ISP_NAME"
echo -e "${MAGENTA}====================================================${RESET}"
echo -e "${CYAN}Channel:${RESET} $TG_CHANNEL"
echo -e "${CYAN}Group:  ${RESET} $TG_GROUP"
echo -e "${CYAN}Contact:${RESET} $TG_ID"
echo -e "${MAGENTA}====================================================${RESET}"

fetch_ipv4() {
  local file="$OUTDIR/${SAFE_NAME}_ipv4.txt"
  whois -h whois.radb.net -i origin "$ASN" 2>/dev/null | awk '/^route:/{print $2}' | sort -V -u > "$file"
  { echo "ASN: $ASN | ISP: $ISP_NAME"; cat "$file"; } > "${file}.tmp" && mv "${file}.tmp" "$file"
  echo -e "✅ ${GREEN}IPv4 prefixes saved to:${RESET} $file"
}
fetch_ipv6() {
  local file="$OUTDIR/${SAFE_NAME}_ipv6.txt"
  whois -h whois.radb.net -i origin "$ASN" 2>/dev/null | awk '/^route6:/{print $2}' | sort -V -u > "$file"
  { echo "ASN: $ASN | ISP: $ISP_NAME"; cat "$file"; } > "${file}.tmp" && mv "${file}.tmp" "$file"
  echo -e "✅ ${GREEN}IPv6 prefixes saved to:${RESET} $file"
}
case "$MODE" in
  ipv4) fetch_ipv4;;
  ipv6) fetch_ipv6;;
  both) fetch_ipv4; fetch_ipv6;;
esac
